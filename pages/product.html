<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Website</title>
    <link href="../css/product.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
    <link href="../css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../image/icon/themify-icons/themify-icons.css">
</head>

<body>
  <div class="header">
    <div class="header__top">
        <div class="header__search">
          <input type="text" class="header__search-box" placeholder="Tìm kiếm..." name="" id="">
          <i class="header_search-icon ti-search"></i>
        </div>
        <div class="header__logo">
          <img src="/image/logo/NEU_logo.svg" alt="" class="header__brand-logo">
          <img src="/image/logo/gnc_logo.svg" alt="" class="header__brand-logo">
          <img src="/image/logo/fuwa3e-logo.svg" style="width: 9.5rem;" alt="" class="header__brand-logo">
        </div>
        <div class="header__navigation">
          <ul class="header__nav-list">
            <li class="header__nav-item">
              <a href="/index.html" class="header__nav-link">
                Trang chủ
                <i class="ti-home"></i>
              </a>
            </li>
            <li class="header__nav-item">
              <a href="/pages/products.html" class="header__nav-link">
                Sản phẩm/Dịch vụ
                <i class="ti-shopping-cart-full"></i>
              </a>
            </li>
            <li class="header__nav-item">
              <a href="/pages/news.html" class="header__nav-link">  
                Tin tức
                <i class="ti-bell"></i>
                <i class="ti-angle-double-down"></i>
              </a>
              <ul class="header__subnav">
                <li class="header_subnav-item">
                  <a href="/pages/info.html" class="header__subnav-link">
                    Thông tin
                  </a>
                </li>
                <li class="header_subnav-item">
                  <a href="/pages/event.html" class="header__subnav-link">Sự kiện</a>
                </li>
              </ul>
            </li>
            <li class="header__nav-item">
              <a href="" class="header__nav-link">
                Hỗ trợ 
                <i class="ti-headphone-alt"></i>
                <i class="ti-angle-double-down"></i>
              </a>
              <ul class="header__subnav">
                <li class="header__subnav-item">
                  <a href="/pages/contact.html" class="header__subnav-link">Liên hệ</a>
                </li>
                <li class="header_subnav-item">
                  <a href="/pages/fag.html" class="header__subnav-link">FAQ</a>
                </li>
              </ul>
            </li>
            <li class="header__nav-item">
              <a href="/pages/recruitment.html" class="header__nav-link">Tuyển dụng</a>
            </li>
          </ul>
        </div>
        <div class="header__action-item">
          <a title="Đăng nhập" href="/pages/login.html" class="header__action-button">
            <i class="ti-user"></i>
          </a>
          <a title="Giỏ hàng" href="/pages/cart.html" class="header__action-button">               
              <i class="ti-shopping-cart"></i>
              <span class="cart-count">0</span>
          </a>
        </div>
    </div>
  </div>
    <div class="product-detail" id="product-detail">Đang tải sản phẩm...</div>
    <footer class="footer">
      <div class="footer__container">
        <div class="footer__column footer__column--info">
          <h4 class="footer__title">VĂN PHÒNG FUWA</h4>
          <ul class="footer__list">
            <li class="footer__item"><strong>Nhà máy:</strong> 04 Đồng Cổ, Phường Hàm Rồng, TP Thanh Hóa, Tỉnh Thanh Hóa</li>
            <li class="footer__item"><strong>TP.HCM:</strong> 09 Đỗ Thừa Tự, Phường Tân Quý, Quận Tân Phú, TP. Hồ Chí Minh</li>
            <li class="footer__item"><strong>Hà Nội:</strong> Số 2 Ngách 23 Ngõ 62 Nguyễn Chí Thanh, Quận Đống Đa, TP. Hà Nội</li>
            <li class="footer__item"><strong>Đà Nẵng:</strong> 114 Đường Văn An, Phường Mân Thái, Quận Sơn Trà, TP. Đà Nẵng</li>
            <li class="footer__item"><strong>VP Đức:</strong> Ziehtlenbühndweg 22a, 77704 Oberkirch, Baden-Württemberg, Deutschland</li>
          </ul>
        </div>
    
        <div class="footer__column footer__column--policy">
          <h4 class="footer__title">CHÍNH SÁCH FUWA</h4>
          <ul class="footer__list">
            <li class="footer__item">Chính sách bán hàng</li>
            <li class="footer__item">Điều khoản sử dụng</li>
            <li class="footer__item">Điểm bán hàng</li>
          </ul>
        </div>
    
        <div class="footer__column footer__column--contact">
          <h4 class="footer__title">THÔNG TIN LIÊN HỆ</h4>
          <p class="footer__item"><i class="ti-headphone-alt"></i> Kinh Doanh: 0972.377.898 (Hotline)</p>
        </div>
    
        <div class="footer__column footer__column--links">
          <h4 class="footer__title">WEBSITE LIÊN KẾT</h4>
          <div class="footer__logos">
            <a href="#" class="footer__logo-link">
              <img src="/image/homepage/footer-ecoenzyme.jpg" alt="EcoEnzyme" class="footer__logo">
            </a>
            <a href="#" class="footer__logo-link">
              <img src="/image/homepage/footer-sweet-boss.jpg" alt="SweetieBoss" class="footer__logo">
            </a>
            <a href="#" class="footer__logo-link">
              <img src="/image/homepage/footer-refill3er.jpg" alt="Refill Station" class="footer__logo">
            </a>
          </div>
        </div>
    
        <div class="footer__column footer__column--social">
          <h4 class="footer__title">KẾT NỐI VỚI FUWA</h4>
          <div class="footer__social-icons">
            <a href="#" class="footer__icon"><i class="ti-facebook"></i></a>
            <a href="#" class="footer__icon"><i class="ti-world"></i></a>
            <a href="#" class="footer__icon"><i class="ti-instagram"></i></a>
            <a href="#" class="footer__icon"><i class="ti-music-alt"></i></a>
            <a href="#" class="footer__icon"><i class="ti-youtube"></i></a>
            <a href="#" class="footer__icon"><i class="ti-linkedin"></i></a>
          </div>
        </div>
      </div>
    </footer>
    <script>
      function getRandomInt(min, max) {
          return Math.floor(Math.random() * (max - min + 1)) + min;
      }
  
      function getStars(rating) {
          let stars = '';
          for (let i = 1; i <= 5; i++) {
              stars += i <= rating ? '★' : '☆';
          }
          return stars;
      }
  
      async function loadProduct() {
          const params = new URLSearchParams(location.search);
          const id = params.get("id");
  
          const res = await fetch("../json/products.json");
          const data = await res.json();
          const product = data.find(p => p.id == id);
  
          const box = document.getElementById("product-detail");
  
          if (!product) {
              box.innerHTML = "Không tìm thấy sản phẩm.";
              return;
          }
  
          const purchaseCount = getRandomInt(100, 1000);
          const rating = getRandomInt(1, 5);
  
          box.innerHTML = `
            <div class="product-top">
                <div class="product-img">
                    <img src="${product.img}" alt="${product.name}">
                </div>
                <div class="product-info">
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">${product.price}.000đ</div>
                    <div class="product-meta">
                        Đã bán: ${purchaseCount} | Đánh giá:
                        <span class="stars">${getStars(rating)}</span>
                    </div>
                    <div class="product-buy">
                        <div class="quantity-selector">
                            <span class="quantity-label">Số lượng:</span>
                            <div class="quantity-controls">
                                <button class="quantity-btn minus">-</button>
                                <input type="number" class="quantity-input" value="1" min="1">
                                <button class="quantity-btn plus">+</button>
                            </div>
                        </div>
                        <button class="add-to-cart-btn" data-id="${product.id}">
                            <i class="ti-shopping-cart"></i>
                            Thêm vào giỏ hàng
                        </button>
                    </div>
                </div>
            </div>
            <div class="product-desc">${product.desc}</div>
          `;
  
          // Xử lý sự kiện số lượng
          const minusBtn = document.querySelector('.quantity-btn.minus');
          const plusBtn = document.querySelector('.quantity-btn.plus');
          const quantityInput = document.querySelector('.quantity-input');
          const addToCartBtn = document.querySelector('.add-to-cart-btn');
  
          minusBtn.addEventListener('click', () => {
              let value = parseInt(quantityInput.value);
              if (value > 1) {
                  quantityInput.value = value - 1;
              }
          });
  
          plusBtn.addEventListener('click', () => {
              let value = parseInt(quantityInput.value);
              quantityInput.value = value + 1;
          });
  
          quantityInput.addEventListener('change', () => {
              let value = parseInt(quantityInput.value);
              if (isNaN(value) || value < 1) {
                  quantityInput.value = 1;
              }
          });
  
          // Xóa các sự kiện cũ trước khi thêm mới
          const newAddToCartBtn = addToCartBtn.cloneNode(true);
          addToCartBtn.parentNode.replaceChild(newAddToCartBtn, addToCartBtn);
  let isAddingToCart = false;
          newAddToCartBtn.addEventListener('click', async () => {
            if (isAddingToCart) return; // Ngăn chặn nhiều lần click nhanh
            isAddingToCart = true;
              const quantity = parseInt(quantityInput.value);
              await addToCart(product, quantity);
              showAddedToCartModal(product, quantity);
            isAddingToCart = false;
          });
      }
  
      async function addToCart(product, quantity) {
          let cart = JSON.parse(localStorage.getItem('cart')) || [];
  
          // Lấy thông tin đầy đủ từ products.json
          const res = await fetch("../json/products.json");
          const products = await res.json();
          const fullProduct = products.find(p => p.id == product.id);
  
          if (!fullProduct) return;
  
          // Kiểm tra sản phẩm đã có trong giỏ chưa
          const existingItemIndex = cart.findIndex(item => item.id === product.id);
  
          if (existingItemIndex >= 0) {
              cart[existingItemIndex].quantity += quantity;
          } else {
              cart.push({
                  id: fullProduct.id,
                  name: fullProduct.name,
                  price: fullProduct.price,
                  img: fullProduct.img,
                  quantity: quantity,
                  addedAt: new Date().getTime()
              });
          }
  
          localStorage.setItem('cart', JSON.stringify(cart));
          updateCartCount();
      }
  
      function showAddedToCartModal(product, quantity) {
          const modal = document.createElement('div');
          modal.className = 'added-to-cart-modal';
          modal.innerHTML = `
              <div class="modal-content">
                  <div class="modal-header">
                      <h3>Đã thêm vào giỏ hàng</h3>
                      <span class="close-modal">×</span>
                  </div>
                  <div class="modal-body">
                      <div class="product-added">
                          <img src="${product.img}" alt="${product.name}">
                          <div class="product-info">
                              <h4>${product.name}</h4>
                              <p>Số lượng: ${quantity}</p>
                              <p>Giá: ${product.price}.000đ</p>
                          </div>
                      </div>
                  </div>
                  <div class="modal-footer">
                      <button class="btn-continue">Tiếp tục mua sắm</button>
                      <button class="btn-view-cart">Xem giỏ hàng</button>
                  </div>
              </div>
          `;
  
          document.body.appendChild(modal);
  
          modal.querySelector('.close-modal').addEventListener('click', () => {
              document.body.removeChild(modal);
          });
  
          modal.querySelector('.btn-continue').addEventListener('click', () => {
              document.body.removeChild(modal);
          });
  
          modal.querySelector('.btn-view-cart').addEventListener('click', () => {
              window.location.href = '/pages/cart.html';
          });
  
          setTimeout(() => {
              if (document.body.contains(modal)) {
                  document.body.removeChild(modal);
              }
          }, 5000);
      }
  
      function updateCartCount() {
          let cart = JSON.parse(localStorage.getItem('cart')) || [];
          const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
  
          let cartCount = document.querySelector('.cart-count');
          if (!cartCount) {
              cartCount = document.createElement('span');
              cartCount.className = 'cart-count';
              document.querySelector('.header__action-button[title="Giỏ hàng"]').appendChild(cartCount);
          }
          cartCount.textContent = totalItems;
      }
  
      document.addEventListener('DOMContentLoaded', () => {
          updateCartCount();
          loadProduct();
      });
    </script>
</body>
</html>